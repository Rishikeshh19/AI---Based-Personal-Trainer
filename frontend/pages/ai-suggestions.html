<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Suggestions - AI Personal Trainer Assistant</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/dashboard.css">
    <style>
        .ai-suggestions-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .form-section {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.99) 0%, rgba(240, 249, 255, 0.99) 100%);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08), 0 0 1px rgba(255, 255, 255, 0.5) inset;
            border: 1px solid rgba(30, 64, 175, 0.08);
            margin-bottom: 40px;
        }

        .form-group {
            margin-bottom: 28px;
        }

        .form-group label {
            display: block;
            color: var(--text-dark);
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 10px;
            font-family: 'Poppins', sans-serif;
            letter-spacing: 0.3px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid rgba(30, 64, 175, 0.12);
            border-radius: 12px;
            font-size: 14px;
            font-family: 'Manrope', sans-serif;
            color: var(--text-dark);
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.6);
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #1E40AF;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.08);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }

        .member-info-card {
            background: linear-gradient(135deg, rgba(30, 64, 175, 0.05) 0%, rgba(14, 165, 233, 0.04) 100%);
            border-radius: 16px;
            padding: 20px;
            border: 2px solid rgba(30, 64, 175, 0.12);
            margin-bottom: 25px;
        }

        .member-info-card h4 {
            color: var(--text-dark);
            margin: 0 0 12px 0;
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            font-size: 15px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(30, 64, 175, 0.08);
        }

        .info-item:last-child {
            border-bottom: none;
        }

        .info-label {
            color: var(--text-light);
            font-weight: 500;
            font-size: 14px;
        }

        .info-value {
            color: var(--text-dark);
            font-weight: 700;
            font-size: 15px;
            font-family: 'Poppins', sans-serif;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .button-group .button {
            flex: 1;
            min-width: 150px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
        }

        .button-secondary {
            background: linear-gradient(135deg, rgba(30, 64, 175, 0.08) 0%, rgba(14, 165, 233, 0.06) 100%);
            color: var(--text-dark);
            border: 2px solid rgba(30, 64, 175, 0.25);
        }

        .button-secondary:hover {
            background: linear-gradient(135deg, rgba(30, 64, 175, 0.12) 0%, rgba(14, 165, 233, 0.1) 100%);
            border-color: rgba(30, 64, 175, 0.4);
        }

        .suggestions-result {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.99) 0%, rgba(240, 249, 255, 0.99) 100%);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08), 0 0 1px rgba(255, 255, 255, 0.5) inset;
            border: 1px solid rgba(30, 64, 175, 0.08);
            display: none;
            animation: fadeIn 0.6s ease-out;
        }

        .suggestions-result.show {
            display: block;
        }

        .suggestion-card {
            background: linear-gradient(135deg, rgba(30, 64, 175, 0.06) 0%, rgba(14, 165, 233, 0.04) 100%);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            border: 2px solid rgba(30, 64, 175, 0.12);
            transition: all 0.3s ease;
        }

        .suggestion-card:hover {
            border-color: rgba(30, 64, 175, 0.25);
            box-shadow: 0 4px 16px rgba(30, 64, 175, 0.08);
            transform: translateY(-4px);
        }

        .suggestion-title {
            color: var(--text-dark);
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            font-size: 16px;
            margin: 0 0 10px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .suggestion-description {
            color: var(--text-light);
            font-size: 14px;
            line-height: 1.7;
            margin: 0;
        }

        .badge {
            display: inline-block;
            background: linear-gradient(135deg, #1E40AF 0%, #0369A1 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            margin-right: 8px;
        }

        .weight-tracker {
            background: linear-gradient(135deg, rgba(30, 64, 175, 0.05) 0%, rgba(14, 165, 233, 0.04) 100%);
            border-radius: 16px;
            padding: 24px;
            margin: 25px 0;
            border: 2px solid rgba(30, 64, 175, 0.12);
        }

        .weight-tracker h4 {
            color: var(--text-dark);
            margin: 0 0 16px 0;
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
        }

        .weight-progress {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .weight-box {
            flex: 1;
            text-align: center;
            background: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: inset 0 0 0 1px rgba(124, 58, 237, 0.1);
        }

        .weight-label {
            color: var(--text-light);
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 5px;
        }

        .weight-number {
            color: var(--text-dark);
            font-size: 28px;
            font-weight: 800;
            font-family: 'Poppins', sans-serif;
        }

        .weight-unit {
            color: var(--text-light);
            font-size: 13px;
            margin-top: 2px;
        }

        .arrow {
            color: #7C3AED;
            font-size: 24px;
            font-weight: bold;
        }

        .progress-percentage {
            color: var(--text-dark);
            font-weight: 700;
            font-size: 14px;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--text-light);
        }

        .empty-state h3 {
            color: var(--text-dark);
            margin-bottom: 10px;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 4px solid rgba(124, 58, 237, 0.1);
            border-top: 4px solid #7C3AED;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }

            .button-group {
                flex-direction: column;
            }

            .button-group .button {
                width: 100%;
            }

            .form-section {
                padding: 25px;
            }

            .weight-progress {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>

<body>
    <div class="sidebar">
        <div class="sidebar-header">
            <a href="../index.html" style="text-decoration: none; color: inherit; cursor: pointer;">
                <h1>⚡ AI Trainer</h1>
            </a>
            <button class="sidebar-toggle" type="button" aria-label="Toggle sidebar" title="Toggle sidebar">
                <span class="hamburger-icon">
                    <span></span>
                    <span></span>
                    <span></span>
                </span>
            </button>
        </div>
                        <nav>
            <ul>
                <li><a href="dashboard.html" class="nav-link">Dashboard</a></li>
                <li><a href="muscle-workout.html" class="nav-link">Muscle Workout</a></li>
                <li><a href="select-trainer.html" class="nav-link">Select Trainer</a></li>
                <li><a href="messages.html" class="nav-link">Messages</a></li>
                <li><a href="ai-suggestions.html" class="nav-link">AI Suggestions</a></li>
                <li><a href="progress.html" class="nav-link">View Progress</a></li>
                <li><a href="profile.html" class="nav-link">Profile</a></li>
                <li><a href="#" class="nav-link" id="logout-link">Logout</a></li>
            </ul>
        </nav>
    </div>

    <main>
        <div class="ai-suggestions-container">
            <section>
                <h2>🤖 Get Your AI Recommendations</h2>
                <p>Tell us about your fitness goals and let our AI provide personalized suggestions to help you achieve
                    your desired body weight and fitness level.</p>
            </section>

            <!-- Member Information Form -->
            <div class="form-section">
                <h3
                    style="color: var(--text-dark); margin-top: 0; font-family: 'Poppins', sans-serif; font-weight: 700;">
                    Your Information</h3>

                <div id="member-info" class="member-info-card" style="display: none;">
                    <h4>📋 Current Profile</h4>
                    <div class="info-item">
                        <span class="info-label">Name:</span>
                        <span class="info-value" id="display-name">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Email:</span>
                        <span class="info-value" id="display-email">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Role:</span>
                        <span class="info-value"><span class="badge" id="display-role">Member</span></span>
                    </div>
                </div>

                <form id="ai-form" onsubmit="handleSubmit(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="current-weight">Current Weight (kg) *</label>
                            <input type="number" id="current-weight" placeholder="Enter your current weight" min="20"
                                max="200" step="0.1" required>
                        </div>
                        <div class="form-group">
                            <label for="desired-weight">Desired Weight (kg) *</label>
                            <input type="number" id="desired-weight" placeholder="Enter your target weight" min="20"
                                max="200" step="0.1" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="height">Height (cm) *</label>
                            <input type="number" id="height" placeholder="Enter your height" min="100" max="250"
                                step="0.1" required>
                        </div>
                        <div class="form-group">
                            <label for="age">Age (years) *</label>
                            <input type="number" id="age" placeholder="Enter your age" min="13" max="100" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="fitness-level">Current Fitness Level *</label>
                            <select id="fitness-level" required>
                                <option value="">Select your fitness level</option>
                                <option value="beginner">Beginner</option>
                                <option value="intermediate">Intermediate</option>
                                <option value="advanced">Advanced</option>
                                <option value="athlete">Athlete</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="fitness-goal">Main Fitness Goal *</label>
                            <select id="fitness-goal" required>
                                <option value="">Select your goal</option>
                                <option value="weight-loss">Weight Loss</option>
                                <option value="muscle-gain">Muscle Gain</option>
                                <option value="strength">Strength Building</option>
                                <option value="endurance">Endurance</option>
                                <option value="flexibility">Flexibility</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="medical-conditions">Medical Conditions or Injuries (Optional)</label>
                        <input type="text" id="medical-conditions" placeholder="e.g., Back pain, Knee injury, Asthma">
                    </div>

                    <div class="button-group">
                        <button type="submit" class="button">
                            <span>🚀 Get AI Suggestions</span>
                        </button>
                        <a href="dashboard.html" class="button button-secondary">
                            <span>← Back to Dashboard</span>
                        </a>
                    </div>
                </form>
            </div>

            <!-- Loading State -->
            <div class="loading" id="loading-state">
                <div class="spinner"></div>
                <h3 style="color: var(--text-dark);">Analyzing your profile...</h3>
                <p style="color: var(--text-light);">Our AI is generating personalized recommendations for you.</p>
            </div>

            <!-- Results Section -->
            <div class="suggestions-result" id="suggestions-result">
                <h2>✨ Your Personalized Recommendations</h2>

                <div class="weight-tracker">
                    <h4>📊 Weight Goal Progress</h4>
                    <div class="weight-progress">
                        <div class="weight-box">
                            <div class="weight-label">Current Weight</div>
                            <div class="weight-number" id="result-current-weight">0</div>
                            <div class="weight-unit">kg</div>
                        </div>
                        <div class="arrow">→</div>
                        <div class="weight-box">
                            <div class="weight-label">Target Weight</div>
                            <div class="weight-number" id="result-desired-weight">0</div>
                            <div class="weight-unit">kg</div>
                        </div>
                        <div style="flex: 1; text-align: center;">
                            <div class="weight-label">Weight to Change</div>
                            <div class="progress-percentage" id="weight-difference">0 kg</div>
                            <div class="weight-unit" id="change-type">Loss</div>
                        </div>
                    </div>
                </div>

                <div id="ai-suggestions-container">
                    <!-- AI suggestions will be rendered here -->
                    <div class="empty-state">
                        <p>⏳ Waiting for LLM response... This feature will integrate with your LLM API.</p>
                    </div>
                </div>

                <div class="button-group">
                    <button class="button" onclick="resetForm()">
                        <span>🔄 Get New Suggestions</span>
                    </button>
                    <a href="dashboard.html" class="button button-secondary">
                        <span>← Back to Dashboard</span>
                    </a>
                </div>
            </div>
        </div>
    </main>

    <script src="../js/storage.js"></script>
    <script src="../js/nav.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const token = localStorage.getItem("token");
            if (!token) {
                window.location.href = "login.html";
                return;
            }
            updateNavigation(token);

            const logoutLink = document.getElementById("logout-link");
            if (logoutLink) {
                logoutLink.addEventListener("click", function (e) {
                    e.preventDefault();
                    logout();
                });
            }

            // Load and display member info
            loadMemberInfo();
        });

        function loadMemberInfo() {
            const memberInfo = document.getElementById("member-info");
            if (memberInfo) {
                // Get current user from storage
                const currentUser = storage.getCurrentUser();
                console.log("AI Suggestions - Current User:", currentUser);

                if (currentUser) {
                    memberInfo.style.display = "block";
                    // Try multiple possible name fields
                    const name = currentUser.name || currentUser.username || currentUser.firstName || "Member";
                    document.getElementById("display-name").textContent = name;
                    document.getElementById("display-email").textContent = currentUser.email || "member@example.com";

                    const roleElement = document.getElementById("display-role");
                    if (roleElement) {
                        roleElement.textContent = (currentUser.role || "Member").charAt(0).toUpperCase() + (currentUser.role || "member").slice(1);
                    }
                } else {
                    console.warn("No current user found in storage");
                }
            }
        }

        function handleSubmit(event) {
            event.preventDefault();

            const currentWeight = parseFloat(document.getElementById("current-weight").value);
            const desiredWeight = parseFloat(document.getElementById("desired-weight").value);
            const height = parseFloat(document.getElementById("height").value);
            const age = parseInt(document.getElementById("age").value);
            const fitnessLevel = document.getElementById("fitness-level").value;
            const fitnessGoal = document.getElementById("fitness-goal").value;
            const medicalConditions = document.getElementById("medical-conditions").value;

            // Validate inputs
            if (currentWeight <= 0 || desiredWeight <= 0) {
                alert("Please enter valid weight values");
                return;
            }

            // Show loading state
            document.getElementById("ai-form").style.display = "none";
            document.getElementById("loading-state").classList.add("show");

            // Prepare data for LLM
            const llmPrompt = generateLLMPrompt(
                currentWeight,
                desiredWeight,
                height,
                age,
                fitnessLevel,
                fitnessGoal,
                medicalConditions
            );

            // TODO: Send to your LLM API here
            // Example:
            // callLLMAPI(llmPrompt).then(response => {
            //     displaySuggestions(response, currentWeight, desiredWeight);
            // });

            // For now, simulate with mock data
            setTimeout(() => {
                displayMockSuggestions(currentWeight, desiredWeight, fitnessLevel, fitnessGoal);
            }, 2000);
        }

        function generateLLMPrompt(currentWeight, desiredWeight, height, age, fitnessLevel, fitnessGoal, medicalConditions) {
            let prompt = `I am a ${age}-year-old person with the following fitness profile:
- Current Weight: ${currentWeight} kg
- Target Weight: ${desiredWeight} kg
- Height: ${height} cm
- Current Fitness Level: ${fitnessLevel}
- Main Fitness Goal: ${fitnessGoal}`;

            if (medicalConditions) {
                prompt += `\n- Medical Conditions/Injuries: ${medicalConditions}`;
            }

            prompt += `\n\nBased on this information, please provide:
1. A personalized workout plan (3-5 exercises per day, 5 days a week)
2. Dietary recommendations
3. Expected timeline to reach the target weight
4. Key metrics to track progress
5. Potential challenges and how to overcome them
6. Motivational tips

Format the response with clear sections and actionable advice.`;

            return prompt;
        }

        function displayMockSuggestions(currentWeight, desiredWeight, fitnessLevel, fitnessGoal) {
            // Hide form and loading, show results
            document.getElementById("loading-state").classList.remove("show");
            document.getElementById("suggestions-result").classList.add("show");

            // Update weight info
            document.getElementById("result-current-weight").textContent = currentWeight;
            document.getElementById("result-desired-weight").textContent = desiredWeight;

            const weightDifference = Math.abs(currentWeight - desiredWeight);
            const changeType = currentWeight > desiredWeight ? "Loss" : "Gain";
            document.getElementById("weight-difference").textContent = `${weightDifference.toFixed(1)} kg`;
            document.getElementById("change-type").textContent = changeType;

            // Mock suggestions
            const suggestions = [
                {
                    icon: "💪",
                    title: "Personalized Workout Plan",
                    description: `Based on your ${fitnessLevel} fitness level and ${fitnessGoal} goal, we recommend 5 days of exercise per week combining strength training and cardio. Start with 30-45 minute sessions.`
                },
                {
                    icon: "🥗",
                    title: "Nutrition Strategy",
                    description: `Maintain a balanced diet with adequate protein (1.6-2.2g per kg body weight), complex carbs, and healthy fats. Create a caloric deficit of 300-500 calories per day for weight loss.`
                },
                {
                    icon: "📈",
                    title: "Progress Tracking",
                    description: `Track your weight weekly, take measurements monthly, and monitor performance metrics like strength gains and endurance improvements.`
                },
                {
                    icon: "⏱️",
                    title: "Expected Timeline",
                    description: `With consistent effort, you can expect to reach your weight goal in ${Math.ceil(Math.abs(currentWeight - desiredWeight) / 0.5)} weeks. Results may vary based on adherence.`
                }
            ];

            // Render suggestions
            const container = document.getElementById("ai-suggestions-container");
            container.innerHTML = suggestions.map(s => `
                <div class="suggestion-card">
                    <h4 class="suggestion-title">${s.icon} ${s.title}</h4>
                    <p class="suggestion-description">${s.description}</p>
                </div>
            `).join("");

            // Scroll to results
            document.getElementById("suggestions-result").scrollIntoView({ behavior: 'smooth' });
        }

        function resetForm() {
            document.getElementById("ai-form").reset();
            document.getElementById("ai-form").style.display = "block";
            document.getElementById("suggestions-result").classList.remove("show");
        }

        function logout() {
            localStorage.removeItem("token");
            window.location.href = "login.html";
        }
    </script>
</body>

</html>