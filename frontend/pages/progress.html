<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Progress Tracking - AI Personal Trainer Assistant</title>
    <link rel="stylesheet" href="../css/style-premium.css">
    <link rel="stylesheet" href="../css/dashboard-premium.css">
    <link rel="stylesheet" href="../css/components.css">
</head>

<body>
    <div class="sidebar">
        <div class="sidebar-header">
            <a href="../index.html" style="text-decoration: none; color: inherit; cursor: pointer;">
                <h1>‚ö° AI Trainer</h1>
            </a>
            <button class="sidebar-toggle" type="button" aria-label="Toggle sidebar" title="Toggle sidebar">
                <span class="hamburger-icon">
                    <span></span>
                    <span></span>
                    <span></span>
                </span>
            </button>
        </div>
        <nav>
            <ul>
                <li><a href="dashboard.html" class="nav-link">Dashboard</a></li>
                <li><a href="muscle-workout.html" class="nav-link">Muscle Workout</a></li>
                <li><a href="select-trainer.html" class="nav-link">Select Trainer</a></li>
                <li><a href="messages.html" class="nav-link">Messages</a></li>
                <li><a href="ai-suggestions.html" class="nav-link">AI Suggestions</a></li>
                <li id="diet-plan-item"><a href="diet-plan.html" class="nav-link">AI Diet Plan</a></li>
                <li><a href="progress.html" class="nav-link">View Progress</a></li>
                <li><a href="profile.html" class="nav-link">Profile</a></li>
                <li><a href="#" class="nav-link" id="logout-link">Logout</a></li>
            </ul>
        </nav>
    </div>

    <main>
        <section id="progress-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin: 0;">Your Fitness Progress</h2>
                <div style="display: flex; gap: 10px;">
                    <button class="filter-btn-progress active" data-filter="weekly" style="padding: 8px 16px; background: #5A00FF; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; transition: all 0.3s;">Weekly</button>
                    <button class="filter-btn-progress" data-filter="monthly" style="padding: 8px 16px; background: #f0f0f0; color: #333; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; transition: all 0.3s;">Monthly</button>
                    <button class="filter-btn-progress" data-filter="all" style="padding: 8px 16px; background: #f0f0f0; color: #333; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; transition: all 0.3s;">All Time</button>
                </div>
            </div>
            <div id="progress-data" class="empty-state">
                <h3>No progress data yet</h3>
                <p>Start logging workouts to see your progress</p>
            </div>
        </section>

        <section id="weekly-stats">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin: 0;">Weekly Statistics</h2>
                <div style="display: flex; gap: 10px;">
                    <button class="period-btn active" data-period="current" style="padding: 8px 16px; background: #5A00FF; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; transition: all 0.3s;">Current Week</button>
                    <button class="period-btn" data-period="previous" style="padding: 8px 16px; background: #f0f0f0; color: #333; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; transition: all 0.3s;">Previous Week</button>
                    <button class="period-btn" data-period="all" style="padding: 8px 16px; background: #f0f0f0; color: #333; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; transition: all 0.3s;">All Weeks</button>
                </div>
            </div>
            <div class="dashboard-container">
                <div class="stats-card">
                    <div class="card-icon">üèãÔ∏è</div>
                    <h3>Workouts This Week</h3>
                    <div class="stat-value" id="weekly-workouts">0</div>
                </div>
                <div class="stats-card">
                    <div class="card-icon">üî•</div>
                    <h3>Calories This Week</h3>
                    <div class="stat-value" id="weekly-calories">0</div>
                </div>
                <div class="stats-card">
                    <div class="card-icon">‚è±Ô∏è</div>
                    <h3>Total Time</h3>
                    <div class="stat-value" id="total-time">0h</div>
                </div>
            </div>
        </section>

        <section id="monthly-stats">
            <h2>Monthly Overview</h2>
            <div id="monthly-data" class="empty-state">
                <h3>No monthly data available</h3>
                <p>Your monthly statistics will appear here</p>
            </div>
        </section>

        <section id="goals-section">
            <h2>üéØ Goals</h2>
            <div id="goals-data" class="empty-state">
                <h3>Set Your Fitness Goals</h3>
                <p>Define your fitness goals to track progress better</p>
            </div>
        </section>
    </main>

    <div class="footer">
        <p>&copy; 2025 AI Personal Trainer Assistant. All rights reserved.</p>
    </div>

    <script src="../js/storage.js"></script>
    <script src="../js/nav.js"></script>
    <script src="../js/api.js"></script>
    <script src="http://localhost:8000/socket.io/socket.io.js"></script>
    <script src="../js/progress.js"></script>

    <style>
        #progress-data .progress-card {
            background: var(--light-bg);
            padding: 20px;
            margin: 15px 0;
            border-radius: 10px;
            border-left: 4px solid var(--accent-color);
        }

        #progress-data h4 {
            margin: 0 0 10px 0;
            color: var(--primary-color);
        }

        #progress-data p {
            margin: 5px 0;
            color: var(--text-light);
            font-size: 14px;
        }
    </style>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const token = localStorage.getItem("token");
            if (!token) {
                window.location.href = "login.html";
                return;
            }

            // Progress filter button handling
            const filterBtns = document.querySelectorAll('.filter-btn-progress');
            filterBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    // Remove active styling from all buttons
                    filterBtns.forEach(b => {
                        b.style.background = '#f0f0f0';
                        b.style.color = '#333';
                        b.classList.remove('active');
                    });
                    // Add active styling to clicked button
                    this.style.background = '#5A00FF';
                    this.style.color = 'white';
                    this.classList.add('active');
                    
                    const filter = this.getAttribute('data-filter');
                    loadProgressData(filter);
                });
            });

            // Period button handling
            const periodBtns = document.querySelectorAll('.period-btn');
            periodBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    // Remove active class from all buttons
                    periodBtns.forEach(b => {
                        b.style.background = '#f0f0f0';
                        b.style.color = '#333';
                    });
                    // Add active class to clicked button
                    this.style.background = '#5A00FF';
                    this.style.color = 'white';
                    this.classList.add('active');
                    
                    const period = this.getAttribute('data-period');
                    loadWeeklyStats(period);
                });
            });

            const logoutLink = document.getElementById("logout-link");
            if (logoutLink) {
                logoutLink.addEventListener("click", function (e) {
                    e.preventDefault();
                    logout();
                });
            }

            // Load initial data
            loadProgressData('weekly');
            loadWeeklyStats('current');
        });

        async function loadProgressData(filter) {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`http://localhost:8000/api/progress?filter=${filter}`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) throw new Error('Failed to fetch progress data');
                
                const data = await response.json();
                displayProgressData(data, filter);
            } catch (error) {
                console.error('Error loading progress data:', error);
                document.getElementById('progress-data').innerHTML = '<h3>Error loading data</h3>';
            }
        }

        async function loadWeeklyStats(period) {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`http://localhost:8000/api/progress/weekly?period=${period}`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) throw new Error('Failed to fetch weekly stats');
                
                const stats = await response.json();
                displayWeeklyStats(stats);
            } catch (error) {
                console.error('Error loading weekly stats:', error);
                document.getElementById('weekly-workouts').textContent = '0';
                document.getElementById('weekly-calories').textContent = '0';
                document.getElementById('total-time').textContent = '0h';
            }
        }

        function displayProgressData(data, filter) {
            const container = document.getElementById('progress-data');
            
            if (!data.workouts || data.workouts.length === 0) {
                container.innerHTML = '<h3>No workouts recorded</h3><p>Start logging workouts to see your progress</p>';
                return;
            }

            let html = `<div style="margin-top: 20px;">`;
            
            data.workouts.forEach(workout => {
                const date = new Date(workout.date).toLocaleDateString();
                const muscles = workout.exercises?.map(e => e.name || e).join(', ') || 'N/A';
                html += `
                    <div class="progress-card">
                        <h4>üìÖ ${date}</h4>
                        <p><strong>Muscle Groups:</strong> ${muscles}</p>
                        <p><strong>Duration:</strong> ${workout.duration || 0} mins</p>
                        <p><strong>Calories:</strong> üî• ${workout.totalCalories || 0} cal</p>
                        <p><strong>Sets & Reps:</strong> ${workout.sets || 0} √ó ${workout.reps || 0}</p>
                    </div>
                `;
            });

            html += `</div>`;
            container.innerHTML = html;
        }

        function displayWeeklyStats(stats) {
            document.getElementById('weekly-workouts').textContent = stats.workoutCount || '0';
            document.getElementById('weekly-calories').textContent = stats.totalCalories || '0';
            
            const hours = Math.floor((stats.totalDuration || 0) / 60);
            const mins = (stats.totalDuration || 0) % 60;
            document.getElementById('total-time').textContent = hours > 0 ? `${hours}h ${mins}m` : `${mins}m`;
        }
    </script>
</body>

</html>